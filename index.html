<!DOCTYPE html>
<html>
<head>
  <title>ESP32 RGB JSON Control</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body style="text-align:center;font-family:Arial;background:black;color:white;">

<h1>RGB & Brightness (JSON)</h1>

<input type="range" id="brt" min="0" max="100" value="0">
<p>Brightness: <span id="vbrt">0</span>%</p>

<input type="range" id="r" min="0" max="100" value="0">
<p>Red: <span id="vr">0</span>%</p>

<input type="range" id="g" min="0" max="100" value="0">
<p>Green: <span id="vg">0</span>%</p>

<input type="range" id="b" min="0" max="100" value="0">
<p>Blue: <span id="vb">0</span>%</p>

<div id="color" style="width:120px;height:120px;border:2px solid white;margin:auto;"></div>

<script>
const brt = document.getElementById("brt");
const r   = document.getElementById("r");
const g   = document.getElementById("g");
const b   = document.getElementById("b");

const vbrt = document.getElementById("vbrt");
const vr = document.getElementById("vr");
const vg = document.getElementById("vg");
const vb = document.getElementById("vb");

const box = document.getElementById("color");

const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt", {
  clientId: "web_" + Math.random()
});

function publishJSON() {
  const payload = {
    r:   Math.round(r.value   * 40.95),
    g:   Math.round(g.value   * 40.95),
    b:   Math.round(b.value   * 40.95),
    brt: Math.round(brt.value * 40.95)
  };

  client.publish(
    "pranav/esp32/rgb/cmd/json",
    JSON.stringify(payload)
  );

  const scale = brt.value / 100;
  box.style.background =
    `rgb(${r.value*2.55*scale},
         ${g.value*2.55*scale},
         ${b.value*2.55*scale})`;
}

[r, g, b, brt].forEach(sl => {
  sl.oninput = () => {
    vr.innerText = r.value;
    vg.innerText = g.value;
    vb.innerText = b.value;
    vbrt.innerText = brt.value;
    publishJSON();
  };
});
</script>

</body>
</html>
